cmake_minimum_required(VERSION 3.10)
project(bls12_381_ctypes)

# Set C++ standard
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Set source directory
set(CMAKE_SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR})

# Include directories for MCL and BLS12-381
include_directories(${CMAKE_SOURCE_DIR}/3rd/hyrax-bls12-381/3rd/mcl/include)
include_directories(${CMAKE_SOURCE_DIR}/3rd/hyrax-bls12-381/src)

# Find the MCL library
find_library(MCL_LIBRARY
    NAMES mcl libmcl
    PATHS ${CMAKE_SOURCE_DIR}/3rd/hyrax-bls12-381/3rd/mcl/lib
    NO_DEFAULT_PATH
)

if(NOT MCL_LIBRARY)
    message(FATAL_ERROR "MCL library not found in ${CMAKE_SOURCE_DIR}/3rd/hyrax-bls12-381/3rd/mcl/lib")
endif()

message(STATUS "Found MCL library: ${MCL_LIBRARY}")

# Create shared library
add_library(bls12_381_ctypes SHARED ${CMAKE_SOURCE_DIR}/bls12_381_ctypes_wrapper_simple.cpp)

# Link against MCL libraries
target_link_libraries(bls12_381_ctypes ${MCL_LIBRARY})

# Set compiler flags
if(MSVC)
    target_compile_options(bls12_381_ctypes PRIVATE /std:c++17)
else()
    target_compile_options(bls12_381_ctypes PRIVATE -std=c++17)
endif()

# Set output name
set_target_properties(bls12_381_ctypes PROPERTIES OUTPUT_NAME "bls12_381_ctypes")
